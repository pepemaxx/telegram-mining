<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pi Net Mining</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#111; color:#fff; }
    .tabs { display:flex; justify-content:space-around; background:#222; padding:10px 0; position:fixed; bottom:0; width:100%; }
    .tab { flex:1; text-align:center; padding:10px; cursor:pointer; color:#aaa; }
    .tab.active { color:#fff; font-weight:bold; }
    .page { display:none; padding:20px; padding-bottom:80px; }
    .page.active { display:block; }
    .coin-btn {
      width:120px; height:120px; border-radius:50%;
      background:gold; border:4px solid #ffcc00;
      display:flex; justify-content:center; align-items:center;
      font-weight:bold; font-size:20px; color:#000;
      margin:30px auto; cursor:pointer; box-shadow:0 0 20px gold;
      transition: transform 0.2s;
    }
    .coin-btn:hover { transform:scale(1.1); }
    .news-section {
      margin-top:40px; padding:15px; background:#222; border-radius:10px;
    }
    .news-item { padding:5px 0; border-bottom:1px solid #333; }
    .news-item:last-child { border-bottom:none; }
  </style>
</head>
<body>

  <!-- Pages -->
  <div id="mining" class="page active">
    <h2>Mining</h2>
    <div id="coinBtn" class="coin-btn">Pi Net</div>
    <p>Clicks: <span id="clicks">0</span></p>
    <p>Balance: <span id="balance">0</span> Pi</p>

    <!-- News Section -->
    <div class="news-section">
      <h3>News</h3>
      <div id="newsList">Loading news...</div>
    </div>
  </div>

  <div id="tasks" class="page">
    <h2>Daily Tasks</h2>
    <div id="taskList">Loading tasks...</div>
  </div>

  <div id="friends" class="page">
    <h2>Friends</h2>
    <div id="friendsList">Loading friends...</div>
  </div>

  <div id="wallet" class="page">
    <h2>Wallet</h2>
    <div id="walletInfo">Loading wallet...</div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" data-page="mining">Mining</div>
    <div class="tab" data-page="tasks">Tasks</div>
    <div class="tab" data-page="friends">Friends</div>
    <div class="tab" data-page="wallet">Wallet</div>
  </div>

  <script>
    const API_BASE = "https://pinet-backend-production.up.railway.app";

    const tabs = document.querySelectorAll('.tab');
    const pages = document.querySelectorAll('.page');
    tabs.forEach(tab=>{
      tab.addEventListener('click',()=>{
        tabs.forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        pages.forEach(p=>p.classList.remove('active'));
        document.getElementById(tab.dataset.page).classList.add('active');
        if(tab.dataset.page==="mining"){ loadMining(); loadNews(); }
        if(tab.dataset.page==="tasks"){ loadTasks(); }
        if(tab.dataset.page==="friends"){ loadFriends(); }
        if(tab.dataset.page==="wallet"){ loadWallet(); }
      });
    });

    const clickEl=document.getElementById('clicks');
    const balanceEl=document.getElementById('balance');

    document.getElementById('coinBtn').addEventListener('click', async ()=>{
      try {
        const res = await fetch(`${API_BASE}/mine`, { method:"POST" });
        const data = await res.json();
        clickEl.textContent=data.clicks;
        balanceEl.textContent=data.balance.toFixed(2);
      } catch (err){
        console.error(err);
        alert("⚠️ Failed to mine");
      }
    });

    async function loadMining(){
      try {
        const res = await fetch(`${API_BASE}/mining`);
        const data = await res.json();
        clickEl.textContent=data.clicks;
        balanceEl.textContent=data.balance.toFixed(2);
      } catch (err){
        console.error(err);
      }
    }

    async function loadNews(){
      const newsList=document.getElementById("newsList");
      newsList.innerHTML="Loading news...";
      try {
        const res = await fetch(`${API_BASE}/news`);
        const data = await res.json();
        newsList.innerHTML="";
        if(Array.isArray(data) && data.length>0){
          data.forEach(item=>{
            const div=document.createElement("div");
            div.className="news-item";
            div.textContent=item;
            newsList.appendChild(div);
          });
        } else {
          newsList.innerHTML="<p>No news available.</p>";
        }
      } catch (err){
        console.error(err);
        newsList.innerHTML="<p>⚠️ Failed to load news.</p>";
      }
    }

    async function loadTasks(){
      const taskList=document.getElementById("taskList");
      taskList.innerHTML="Loading tasks...";
      try {
        const res = await fetch(`${API_BASE}/tasks`);
        const data = await res.json();
        taskList.innerHTML=data.map(t=>`<p>• ${t}</p>`).join("");
      } catch (err){
        taskList.innerHTML="<p>⚠️ Failed to load tasks.</p>";
      }
    }

    async function loadFriends(){
      const friendsList=document.getElementById("friendsList");
      friendsList.innerHTML="Loading friends...";
      try {
        const res = await fetch(`${API_BASE}/friends`);
        const data = await res.json();
        friendsList.innerHTML=data.map(f=>`<p>${f}</p>`).join("");
      } catch (err){
        friendsList.innerHTML="<p>⚠️ Failed to load friends.</p>";
      }
    }

    async function loadWallet(){
      const walletInfo=document.getElementById("walletInfo");
      walletInfo.innerHTML="Loading wallet...";
      try {
        const res = await fetch(`${API_BASE}/wallet`);
        const data = await res.json();
        walletInfo.innerHTML=`<p>Balance: ${data.balance} Pi</p>`;
      } catch (err){
        walletInfo.innerHTML="<p>⚠️ Failed to load wallet.</p>";
      }
    }

    // Load initial data
    loadMining();
    loadNews();
  </script>

</body>
</html>