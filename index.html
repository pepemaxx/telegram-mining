<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PiNet — Mining SPA</title>
  <style>
    :root{
      --bg1:#5a189a; --bg2:#7b2cbf; --ink:#ffffff; --muted:#e2e8f0; --card:rgba(0,0,0,.22);
      --brand:#f1c40f; --border:rgba(255,255,255,.14);
      --good:#10b981; --warn:#f59e0b;
      --safe-area-bottom: env(safe-area-inset-bottom, 12px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      color:var(--ink);
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      height:100vh; overflow:hidden;
    }

    /* background emblem */
    .bg-stage{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:0}
    .emblem{position:relative;width:220px;height:220px;border-radius:50%;background:rgba(255,255,255,.04);display:flex;align-items:center;justify-content:center;box-shadow:inset 0 8px 30px rgba(0,0,0,.25)}
    .emblem .pi{font-size:72px;color:var(--brand);font-weight:900;text-shadow:0 0 18px rgba(241,196,15,.28)}
    .rings{position:absolute;inset:0;display:grid;place-items:center}
    .ring{position:absolute;border:2px solid rgba(241,196,15,.18);border-radius:50%;animation:pulse 6s linear infinite}
    .ring.r1{width:300px;height:300px}
    .ring.r2{width:440px;height:440px}
    .ring.r3{width:580px;height:580px}
    @keyframes pulse{0%{opacity:.5}50%{opacity:.22}100%{opacity:.5}}

    /* solar coins */
    .solar{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}
    .orbit{position:absolute;border:1px dashed rgba(241,196,15,.08);border-radius:50%;animation:spin linear infinite}
    .orbit.o1{width:320px;height:320px;animation-duration:9s}
    .orbit.o2{width:460px;height:460px;animation-duration:13s}
    .orbit.o3{width:600px;height:600px;animation-duration:18s}
    @keyframes spin{to{transform:rotate(360deg)}}
    .coin{position:absolute;width:26px;height:26px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%, #fff7c2, #f1c40f 45%, #b88700 80%);
      box-shadow:0 0 10px rgba(241,196,15,.5)}
    .orbit .coin{top:-13px;left:calc(50% - 13px)}

    /* app layout */
    #app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column}
    main{flex:1;overflow:auto;padding:18px 16px 110px;max-width:900px;margin:0 auto;width:100%}

    .card{
      background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;
      box-shadow:0 8px 30px rgba(0,0,0,.18);margin-bottom:12px;
      backdrop-filter: blur(6px);
    }
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted);font-size:13px}
    .big{font-size:26px;font-weight:800}
    .pill{font-size:13px;padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04)}
    .pill.good{background:rgba(16,185,129,.12);color:#c9f7e6;border-color:rgba(16,185,129,.25)}
    .pill.warn{background:rgba(245,158,11,.12);color:#fff;border-color:rgba(245,158,11,.28)}
    .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.08);overflow:hidden}
    .progress>div{height:100%;background:var(--brand);transition:width .2s ease}

    .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .btn-gold{background:var(--brand);color:#3e1767}
    .btn-ghost{background:transparent;color:var(--ink);border:1px solid var(--border)}

    input,select,textarea{background:rgba(255,255,255,.04);border:1px solid var(--border);color:var(--ink);border-radius:10px;padding:10px 12px;outline:none}
    .input-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    /* tabs bottom */
    nav.tabs{position:fixed;left:0;right:0;bottom:0;padding:8px calc(8px + var(--safe-area-bottom));border-top:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.18));backdrop-filter: blur(8px);z-index:3}
    .tabs-inner{max-width:900px;margin:0 auto;height:76px;display:grid;grid-template-columns:repeat(4,1fr);align-items:center}
    .tab-btn{appearance:none;background:none;border:none;color:var(--muted);font-size:13px;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:6px;cursor:pointer}
    .tab-label{padding:6px 10px;border-radius:10px}
    .tab-btn.active{color:var(--brand)}
    .tab-btn.active .tab-label{background:rgba(241,196,15,.08);border:1px solid rgba(241,196,15,.12)}

    /* small helpers */
    .muted-ss{color:var(--muted);font-size:12px}
    a.keylink{color:var(--brand);text-decoration:none;font-weight:700}

    /* responsive */
    @media (max-width:520px){
      .big{font-size:20px}
      .emblem{width:180px;height:180px}
      .pi{font-size:56px}
    }
  </style>
</head>
<body>
  <!-- background emblem + solar coins -->
  <div class="bg-stage" aria-hidden="true">
    <div class="rings" aria-hidden="true">
      <div class="ring r1"></div>
      <div class="ring r2"></div>
      <div class="ring r3"></div>
    </div>
    <div class="emblem" aria-hidden="true">
      <div class="pi">π</div>
      <div class="solar" aria-hidden="true">
        <div class="orbit o1"><div class="coin"></div></div>
        <div class="orbit o2"><div class="coin"></div></div>
        <div class="orbit o3"><div class="coin"></div></div>
      </div>
    </div>
  </div>

  <div id="app">
    <main>
      <!-- Mining tab -->
      <section class="tab active" id="tab-mining">
        <div class="card row">
          <div>
            <div class="muted">Wallet Balance</div>
            <div class="big"><span id="balance">0</span> <span class="muted" style="font-size:13px">Coins</span></div>
          </div>
          <div style="text-align:right">
            <div class="muted">Mining Status</div>
            <div id="miningStatus" class="pill">Inactive</div>
          </div>
        </div>

        <div class="card">
          <div class="row" style="align-items:flex-end">
            <div>
              <div class="muted">Time Remaining</div>
              <div id="timer" class="big">00:00:00</div>
            </div>
            <div style="text-align:right">
              <div class="muted">Session Earnings</div>
              <div class="big" style="color:var(--brand)"><span id="sessionEarnings">0</span> Coins</div>
            </div>
          </div>

          <div class="progress" style="margin-top:12px"><div id="progressBar" style="width:0%"></div></div>

          <div class="row" style="margin-top:14px">
            <button id="startBtn" class="btn btn-gold">Start 5-hour Mining</button>
            <div style="display:flex;gap:8px">
              <button id="manualClick" class="btn btn-ghost">Manual Click +0.05</button>
              <button id="claimBtn" class="btn btn-ghost" disabled>Finish & Claim</button>
            </div>
          </div>

          <div class="muted" style="margin-top:10px">Rate: <span id="rateText">0.05</span> coins/sec • Progress persists in your browser.</div>
        </div>
      </section>

      <!-- Wallet tab -->
      <section class="tab" id="tab-wallet">
        <div class="card row">
          <div>
            <div class="muted">Coins</div>
            <div class="big" id="coinsBalance">0</div>
          </div>
          <div>
            <div class="muted">Pi</div>
            <div class="big" id="piBalance">0</div>
          </div>
          <div>
            <div class="muted">USDT</div>
            <div class="big" id="usdtBalance">0</div>
          </div>
        </div>

        <div class="card">
          <div class="kicker">Conversions (demo)</div>
          <div class="muted" style="margin-bottom:8px">100 coins → 1 Pi • 1 Pi → 5 USDT</div>
          <div class="input-row" style="margin-bottom:8px">
            <input id="coinsToPiAmt" type="number" min="0" step="1" placeholder="Coins amount">
            <button id="coinsToPiBtn" class="btn btn-gold">Convert Coins → Pi</button>
          </div>
          <div class="input-row" style="margin-bottom:8px">
            <input id="piToUsdtAmt" type="number" min="0" step="0.01" placeholder="Pi amount">
            <button id="piToUsdtBtn" class="btn btn-gold">Convert Pi → USDT</button>
          </div>
        </div>

        <div class="card">
          <div class="kicker">Transactions</div>
          <ul id="txList" style="list-style:none;padding-left:0;margin:0"></ul>
          <div id="noTx" class="muted">No transactions yet.</div>
        </div>
      </section>

      <!-- Friends tab -->
      <section class="tab" id="tab-friends">
        <div class="card">
          <div class="kicker">Your Referral Link</div>
          <div id="refLink" class="muted" style="word-break:break-all;background:rgba(255,255,255,.03);padding:10px;border-radius:10px;border:1px dashed var(--border)"></div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="copyRef" class="btn btn-gold">Copy Link</button>
            <button id="simulateInvite" class="btn btn-ghost">Simulate Invite +1</button>
            <button id="simulateActive" class="btn btn-ghost">Simulate Active +1</button>
          </div>
        </div>

        <div class="card row">
          <div>
            <div class="muted">Invited</div>
            <div class="big" id="friendsInvited">0</div>
          </div>
          <div>
            <div class="muted">Active</div>
            <div class="big" id="friendsActive">0</div>
          </div>
          <div class="pill good">+30 coins per active friend</div>
        </div>
      </section>

      <!-- Tasks tab -->
      <section class="tab" id="tab-tasks">
        <div class="card">
          <div class="kicker">Social Tasks (demo)</div>
          <div id="tasksWrap"></div>
          <div class="muted" style="margin-top:10px">Real verification requires backend integration.</div>
        </div>
      </section>
    </main>

    <nav class="tabs" aria-hidden="false">
      <div class="tabs-inner">
        <button class="tab-btn active" data-tab="mining"><span class="tab-label">Mining</span></button>
        <button class="tab-btn" data-tab="wallet"><span class="tab-label">Wallet</span></button>
        <button class="tab-btn" data-tab="friends"><span class="tab-label">Friends</span></button>
        <button class="tab-btn" data-tab="tasks"><span class="tab-label">Tasks</span></button>
      </div>
    </nav>
  </div>

  <script>
    /* ====== Config ====== */
    const DURATION_MS = 5 * 60 * 60 * 1000; // 5 hours
    const RATE_PER_SEC = 0.05; // demo
    const REF_REWARD = 30;
    const COINS_PER_PI = 100;
    const USDT_PER_PI = 5;
    const STORAGE_KEY = 'pinet_v4_state';

    /* ====== State & Persistence ====== */
    function defaultState(){
      return {
        coins: 0,
        pi: 0,
        usdt: 0,
        tx: [],
        miningStart: null,
        friendsInvited: 0,
        friendsActive: 0,
        completedTasks: []
      };
    }
    function load(){ try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultState(); } catch(e){ return defaultState(); } }
    function save(s){ try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); } catch(e){} }

    const state = load();

    /* ====== Elements ====== */
    const $ = id => document.getElementById(id);
    // Mining
    const balanceEl = $('balance');
    const miningStatusEl = $('miningStatus');
    const timerEl = $('timer');
    const sessionEarningsEl = $('sessionEarnings');
    const progressBarEl = $('progressBar');
    const startBtn = $('startBtn');
    const claimBtn = $('claimBtn');
    const manualClickBtn = $('manualClick');
    const rateText = $('rateText');

    // Wallet
    const coinsBalanceEl = $('coinsBalance');
    const piBalanceEl = $('piBalance');
    const usdtBalanceEl = $('usdtBalance');
    const txListEl = $('txList');
    const noTxEl = $('noTx');
    const coinsToPiAmt = $('coinsToPiAmt');
    const coinsToPiBtn = $('coinsToPiBtn');
    const piToUsdtAmt = $('piToUsdtAmt');
    const piToUsdtBtn = $('piToUsdtBtn');

    // Friends
    const refLinkEl = $('refLink');
    const copyRefBtn = $('copyRef');
    const simulateInviteBtn = $('simulateInvite');
    const simulateActiveBtn = $('simulateActive');
    const friendsInvitedEl = $('friendsInvited');
    const friendsActiveEl = $('friendsActive');

    // Tasks
    const tasksWrap = $('tasksWrap');

    /* ====== Demo tasks & leaderboard ====== */
    const TASKS = [
      { id:'t1', title:'Join our Telegram', url:'#', reward:15 },
      { id:'t2', title:'Follow on Instagram', url:'#', reward:20 },
      { id:'t3', title:'Follow on X', url:'#', reward:20 },
      { id:'t4', title:'Subscribe on YouTube', url:'#', reward:25 },
    ];
    const FAKE_TOP10 = ['ShadowFox','NovaStar','PixelWave','IronClad','BlueComet','SilentPeak','QuantumBee','BrightMint','ArcticFlame','NeonDash'];

    /* ====== Tabs ====== */
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('section.tab').forEach(s=>s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
        // optional: save last-open tab
        try{ localStorage.setItem('pinet_last_tab', btn.dataset.tab); }catch(e){}
      });
    });
    // restore last tab
    (function restoreTab(){
      try{
        const t = localStorage.getItem('pinet_last_tab');
        if(t){
          const b = document.querySelector(`.tab-btn[data-tab="${t}"]`);
          if(b) b.click();
        }
      }catch(e){}
    })();

    /* ====== Mining logic (Date.now-based to handle mobile throttling) ====== */
    rateText.textContent = RATE_PER_SEC.toString();
    let tickId = null;

    function metrics(){
      if(!state.miningStart) return { elapsed:0, remaining:0, progress:0, rewardNow:0 };
      const now = Date.now();
      const elapsed = Math.max(0, now - state.miningStart);
      const remaining = Math.max(0, DURATION_MS - elapsed);
      const clamped = Math.min(elapsed, DURATION_MS);
      const rewardNow = (clamped / 1000) * RATE_PER_SEC;
      const progress = (clamped / DURATION_MS) * 100;
      return { elapsed, remaining, progress, rewardNow };
    }

    function formatHHMMSS(ms){
      const s = Math.max(0, Math.floor(ms/1000));
      const h = String(Math.floor(s/3600)).padStart(2,'0');
      const m = String(Math.floor((s%3600)/60)).padStart(2,'0');
      const ss = String(s%60).padStart(2,'0');
      return `${h}:${m}:${ss}`;
    }

    function tick(){
      const { remaining, progress, rewardNow } = metrics();
      timerEl.textContent = formatHHMMSS(remaining);
      sessionEarningsEl.textContent = rewardNow.toFixed(2);
      progressBarEl.style.width = `${progress}%`;

      if(remaining <= 0 && state.miningStart){
        clearInterval(tickId); tickId = null;
        claimBtn.disabled = false;
        miningStatusEl.textContent = 'Completed — Claim';
        miningStatusEl.className = 'pill warn';
      }
    }

    function runTick(){
      if(tickId) clearInterval(tickId);
      tick(); // immediate
      tickId = setInterval(tick, 1000);
    }

    function updateMiningUI(){
      balanceEl.textContent = Math.floor(state.coins);
      if(state.miningStart){
        startBtn.disabled = true;
        claimBtn.disabled = true;
        miningStatusEl.textContent = 'Active';
        miningStatusEl.className = 'pill good';
        const m = metrics();
        timerEl.textContent = formatHHMMSS(m.remaining);
        sessionEarningsEl.textContent = m.rewardNow.toFixed(2);
        progressBarEl.style.width = `${m.progress}%`;
      }else{
        startBtn.disabled = false;
        claimBtn.disabled = true;
        miningStatusEl.textContent = 'Inactive';
        miningStatusEl.className = 'pill';
        timerEl.textContent = '00:00:00';
        sessionEarningsEl.textContent = '0';
        progressBarEl.style.width = '0%';
      }
    }

    function startMining(){
      if(state.miningStart) return;
      state.miningStart = Date.now();
      pushTx({ type:'info', amount:0, note:'Started 5-hour mining' });
      save(state);
      updateMiningUI();
      runTick();
    }

    function finalizeMining(){
      if(!state.miningStart) return;
      const { rewardNow } = metrics();
      if(rewardNow > 0){
        state.coins = Number(state.coins || 0) + Number(rewardNow);
        pushTx({ type:'earn', amount:rewardNow, note:'Mining reward' });
      }
      state.miningStart = null;
      save(state);
      updateMiningUI();
      renderWallet();
    }

    function manualClick(){
      const amount = 0.05;
      state.coins = Number(state.coins || 0) + amount;
      pushTx({ type:'click', amount, note:'Manual click' });
      save(state);
      renderWallet();
      updateMiningUI();
    }

    /* ====== Transactions helper ====== */
    function pushTx(t){
      t.id = cryptoId();
      t.ts = Date.now();
      state.tx = state.tx || [];
      state.tx.unshift(t);
      state.tx = state.tx.slice(0,200);
      save(state);
    }
    function cryptoId(){ return (crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).slice(2)); }

    /* ====== Wallet / Conversions ====== */
    function setupWallet(){
      coinsToPiBtn.addEventListener('click', ()=>{
        const coins = Math.max(0, Math.floor(Number(coinsToPiAmt.value || 0)));
        if(!coins) return alert('Enter coins amount');
        if(coins > (state.coins || 0)) return alert('Not enough coins');
        const pi = coins / COINS_PER_PI;
        state.coins -= coins;
        state.pi = (Number(state.pi || 0) + pi);
        pushTx({ type:'swap', amount: pi, note:`Converted ${coins} coins → ${pi.toFixed(2)} Pi` });
        coinsToPiAmt.value = '';
        save(state); renderWallet(); updateMiningUI();
      });

      piToUsdtBtn.addEventListener('click', ()=>{
        const pi = Math.max(0, Number(piToUsdtAmt.value || 0));
        if(!pi) return alert('Enter Pi amount');
        if(pi > (state.pi || 0)) return alert('Not enough Pi');
        const usdt = pi * USDT_PER_PI;
        state.pi -= pi;
        state.usdt = (Number(state.usdt || 0) + usdt);
        pushTx({ type:'swap', amount: usdt, note:`Converted ${pi} Pi → ${usdt.toFixed(2)} USDT` });
        piToUsdtAmt.value = '';
        save(state); renderWallet();
      });
    }

    function renderWallet(){
      coinsBalanceEl.textContent = Math.floor(state.coins || 0);
      piBalanceEl.textContent = Number(state.pi || 0).toFixed(2);
      usdtBalanceEl.textContent = Number(state.usdt || 0).toFixed(2);

      txListEl.innerHTML = '';
      if(!state.tx || state.tx.length === 0){ noTxEl.style.display = 'block'; return; }
      noTxEl.style.display = 'none';
      state.tx.slice(0,50).forEach(t=>{
        const li = document.createElement('li');
        li.style.display='flex'; li.style.justifyContent='space-between'; li.style.padding='8px 0'; li.style.borderTop='1px solid rgba(255,255,255,.04)';
        li.innerHTML = `<div>${t.type==='earn'?'+':''}${Number(t.amount||0).toFixed(2)} <span class="muted-ss">— ${t.note||''}</span></div><div class="muted-ss">${new Date(t.ts).toLocaleString()}</div>`;
        txListEl.appendChild(li);
      });
    }

    /* ====== Friends ====== */
    function setupFriends(){
      // simple client-side referral link
      const base = location.origin + location.pathname.replace(/index\\.html$/,'');
      const ref = 'REF-' + (localStorage.getItem('pinet_ref') || (function(){ const v = cryptoId().slice(0,6); localStorage.setItem('pinet_ref', v); return v; })());
      const link = `${base}${base.endsWith('/')?'':'/'}?ref=${encodeURIComponent(ref)}`;
      refLinkEl.textContent = link;

      copyRefBtn.addEventListener('click', async ()=>{
        try{ await navigator.clipboard.writeText(link); alert('Copied'); } catch(e){ alert('Copy failed'); }
      });

      simulateInviteBtn.addEventListener('click', ()=>{
        state.friendsInvited = (Number(state.friendsInvited||0) + 1);
        save(state); renderFriends(); });

      simulateActiveBtn.addEventListener('click', ()=>{
        state.friendsActive = (Number(state.friendsActive||0) + 1);
        state.coins = Number(state.coins||0) + REF_REWARD;
        pushTx({ type:'earn', amount: REF_REWARD, note:'Active friend reward' });
        save(state); renderFriends(); renderWallet(); updateMiningUI();
      });

      renderFriends();
    }
    function renderFriends(){
      friendsInvitedEl.textContent = state.friendsInvited || 0;
      friendsActiveEl.textContent = state.friendsActive || 0;
    }

    /* ====== Tasks ====== */
    function setupTasks(){
      tasksWrap.innerHTML = '';
      TASKS.forEach(t=>{
        const done = (state.completedTasks || []).includes(t.id);
        const row = document.createElement('div');
        row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center'; row.style.margin='8px 0';
        const a = document.createElement('a'); a.href = t.url; a.target='_blank'; a.textContent = t.title; a.style.color='var(--brand)';
        const btn = document.createElement('button'); btn.className = done ? 'btn btn-ghost' : 'btn btn-gold';
        btn.textContent = done ? 'Claimed' : 'Claim';
        btn.disabled = done;
        btn.addEventListener('click', ()=> {
          if(done) return;
          state.completedTasks = state.completedTasks || [];
          state.completedTasks.push(t.id);
          state.coins = Number(state.coins||0) + t.reward;
          pushTx({ type:'earn', amount: t.reward, note: `Task: ${t.title}`});
          save(state); setupTasks(); renderWallet(); updateMiningUI();
        });
        row.appendChild(a); row.appendChild(btn);
        tasksWrap.appendChild(row);
      });
    }

    /* ====== Profile-ish (simple) - keep ID fixed per device ====== */
    (function ensureId(){
      try {
        if(!localStorage.getItem('pinet_user_id')){
          const seed = 112131 + Math.floor(Math.random()*9999);
          localStorage.setItem('pinet_user_id', String(seed));
        }
      }catch(e){}
    })();

    /* ====== Init & bindings ====== */
    function init(){
      // buttons
      startBtn.addEventListener('click', startMining);
      claimBtn.addEventListener('click', finalizeMining);
      manualClickBtn.addEventListener('click', manualClick);

      setupWallet();
      setupFriends();
      setupTasks();

      renderWallet();
      renderFriends();
      updateMiningUI();

      // if mining running, resume tick
      if(state.miningStart){
        const m = metrics();
        if(m.remaining > 0) runTick();
        else { // mining complete but not finalized
          claimBtn.disabled = false;
          miningStatusEl.textContent = 'Completed — Claim';
          miningStatusEl.className = 'pill warn';
        }
      }

      // visibility change: recalc UI (helpful on mobile when tab is backgrounded)
      document.addEventListener('visibilitychange', ()=>{
        updateMiningUI();
        renderWallet();
      });
    }

    // small helper: save current state wrapper
    function save(st){
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(st || state)); } catch(e){}
    }

    // start
    init();

    /* ====== Expose for debugging (optional) ====== */
    window._pinet = { state, save: ()=>save(state) };
  </script>
</body>
</html>