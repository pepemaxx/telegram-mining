<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PiNet – Daily Mining</title>
  <style>
    body {font-family: Arial, sans-serif; margin: 0; padding: 0; background:#f6f6f6;}
    header {background:#222; color:#fff; padding:12px; text-align:center;}
    header .title {font-size:20px; font-weight:700;}
    header .sub {font-size:13px; opacity:.7;}
    nav {display:flex; border-bottom:1px solid #ccc; background:#fff;}
    nav button {flex:1; padding:10px; border:none; background:#eee; cursor:pointer;}
    nav button.active {background:#ddd; font-weight:bold;}
    main {padding:15px;}
    section.tab {display:none;}
    section.tab.active {display:block;}
    .card {background:#fff; border-radius:10px; padding:15px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,.1);}
    .muted {color:#666; font-size:13px;}
    .good {color:green;}
    .warn {color:orange;}
    .progress {height:10px; background:#eee; border-radius:5px; overflow:hidden;}
    .progress-bar {height:10px; background:green; width:0;}
    button {padding:10px 15px; border:none; border-radius:6px; cursor:pointer;}
    button:disabled {opacity:.5; cursor:not-allowed;}
    ul.list {list-style:none; padding:0; margin:0;}
    ul.list li {padding:6px 0; border-bottom:1px solid #eee;}
  </style>
</head>
<body>
  <header>
    <div class="title">PiNet – Daily Mining</div>
    <div class="sub">24h mining • Persistent (LocalStorage)</div>
  </header>

  <nav>
    <button class="tab-btn active" data-tab="mining">Mining</button>
    <button class="tab-btn" data-tab="wallet">Wallet</button>
  </nav>

  <main>
    <!-- Mining -->
    <section class="tab active" id="tab-mining">
      <div class="card">
        <div>Status: <span id="miningStatus" class="muted">Inactive</span></div>
        <div>Timer: <span id="timer">00:00:00</span></div>
        <div>Earnings this session: <span id="sessionEarnings">0</span> PiNet</div>
        <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
        <br>
        <button id="startBtn">Start Mining</button>
        <button id="claimBtn" disabled>Claim</button>
      </div>

      <!-- News Section -->
      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Latest News</div>
        <ul id="newsList" class="list"></ul>
        <div id="noNews" class="muted">Loading news...</div>
      </div>
    </section>

    <!-- Wallet -->
    <section class="tab" id="tab-wallet">
      <div class="card">
        <div>Total Balance: <span id="balance">0</span> PiNet</div>
      </div>
    </section>
  </main>

  <script>
    // ===== Tabs =====
    document.querySelectorAll(".tab-btn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        document.querySelectorAll("section.tab").forEach(sec=>sec.classList.remove("active"));
        document.getElementById("tab-"+tab).classList.add("active");
      });
    });

    // ===== Mining Logic =====
    let balance = 0;
    let sessionEarnings = 0;
    let duration = 24*60*60; // 24h in seconds
    let remaining = 0;
    let miningActive = false;
    let timerInterval;

    const balanceEl = document.getElementById("balance");
    const sessionEl = document.getElementById("sessionEarnings");
    const timerEl = document.getElementById("timer");
    const statusEl = document.getElementById("miningStatus");
    const progressEl = document.getElementById("progressBar");
    const startBtn = document.getElementById("startBtn");
    const claimBtn = document.getElementById("claimBtn");

    function updateTimer(){
      const h = String(Math.floor(remaining/3600)).padStart(2,"0");
      const m = String(Math.floor((remaining%3600)/60)).padStart(2,"0");
      const s = String(remaining%60).padStart(2,"0");
      timerEl.textContent = `${h}:${m}:${s}`;
      const progress = 100*((duration-remaining)/duration);
      progressEl.style.width = progress+"%";
    }

    startBtn.addEventListener("click",()=>{
      if(miningActive) return;
      miningActive = true;
      remaining = duration;
      sessionEarnings = 0;
      sessionEl.textContent = "0";
      statusEl.textContent = "Active";
      statusEl.classList.add("good");
      claimBtn.disabled = true;
      startBtn.disabled = true;

      timerInterval = setInterval(()=>{
        remaining--;
        sessionEarnings++;
        updateTimer();
        sessionEl.textContent = sessionEarnings;
        if(remaining<=0){
          clearInterval(timerInterval);
          claimBtn.disabled = false;
          statusEl.textContent = "Finished";
          statusEl.classList.remove("good");
          statusEl.classList.add("warn");
        }
      },1000);

      updateTimer();
    });

    claimBtn.addEventListener("click",()=>{
      balance += sessionEarnings;
      balanceEl.textContent = balance;
      sessionEarnings = 0;
      sessionEl.textContent = "0";
      statusEl.textContent = "Inactive";
      statusEl.classList.remove("warn","good");
      miningActive = false;
      startBtn.disabled = false;
      claimBtn.disabled = true;
      progressEl.style.width="0%";
      timerEl.textContent="00:00:00";
    });

    balanceEl.textContent = balance;
    updateTimer();

    // ===== News Section =====
    const BACKEND_URL = "https://pinet-backend-production.up.railway.app";
    async function loadNews(){
      try {
        const res = await fetch(`${BACKEND_URL}/news`);
        if(!res.ok) throw new Error("Failed to load news");
        const data = await res.json();
        const newsListEl = document.getElementById("newsList");
        const noNewsEl = document.getElementById("noNews");
        newsListEl.innerHTML = "";
        if(!data.length){
          noNewsEl.textContent = "No news available.";
          return;
        }
        noNewsEl.style.display = "none";
        data.forEach(n => {
          const li = document.createElement("li");
          li.innerHTML = `<div>${n.title}</div><div class="muted">${new Date(n.date).toLocaleString()}</div>`;
          newsListEl.appendChild(li);
        });
      } catch (e) {
        document.getElementById("noNews").textContent = "Error loading news.";
      }
    }
    loadNews();
  </script>
</body>
</html>
