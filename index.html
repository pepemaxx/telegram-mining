<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PiNet – Telegram Mining</title>
<style>
  :root {
    --bg1:#5a189a; --bg2:#7b2cbf; --ink:#ffffff; --muted:#e2e8f0; --card:rgba(0,0,0,.22);
    --brand:#f1c40f; --border:rgba(255,255,255,.2);
    --good:#10b981; --warn:#f59e0b; --disabled:rgba(255,255,255,.4);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,sans-serif;height:100vh;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);}
  header{position:sticky;top:0;background:rgba(0,0,0,.15);padding:12px 16px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--border);}
  .title{font-weight:800;font-size:18px;}
  .sub{font-size:12px;color:var(--muted);}
  .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer;}
  .btn:disabled{opacity:.6;cursor:not-allowed;}
  .btn-gold{background:var(--brand);color:#4c1d95;}
  .btn-ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid var(--border);}
  main{flex:1;overflow-y:auto;padding:16px 16px 100px;max-width:820px;margin:0 auto;display:flex;flex-direction:column;gap:12px;}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px 16px;box-shadow:0 6px 24px rgba(0,0,0,.15);}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px;}
  .muted{color:var(--muted);font-size:12px;}
  .big{font-size:28px;font-weight:800;}
  .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06);}
  .pill.good{background:rgba(16,185,129,.15);color:#d1fae5;border-color:rgba(16,185,129,.4);}
  .pill.warn{background:rgba(245,158,11,.14);color:#fff;border-color:rgba(245,158,11,.45);}
  .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.18);overflow:hidden;margin-top:8px;}
  .progress>div{height:100%;background:var(--brand);transition:width .25s;}
  nav.tabs{position:fixed;left:0;right:0;bottom:0;border-top:1px solid var(--border);background:rgba(0,0,0,.18);}
  .tabs-inner{max-width:820px;margin:0 auto;height:72px;display:grid;grid-template-columns:repeat(5,1fr);}
  .tab-btn{appearance:none;background:none;border:none;color:#e2e8f0;font-size:14px;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:8px;}
  .tab-btn.active{color:var(--brand);}
  section.tab{display:none;}
  section.tab.active{display:block;}
</style>
</head>
<body>

<header>
  <div>
    <div class="title">PiNet – Mining</div>
    <div class="sub">24h mining • Connected to server</div>
  </div>
  <button id="resetBtn" class="btn btn-ghost">Reset</button>
</header>

<main>
  <!-- Mining Tab -->
  <section class="tab active" id="tab-mining">
    <div class="card row">
      <div>
        <div class="muted">Wallet Balance</div>
        <div class="big"><span id="balance">0</span> coins</div>
      </div>
      <div style="text-align:end">
        <div class="muted">Mining Status</div>
        <div id="miningStatus" class="pill">Inactive</div>
      </div>
    </div>

    <div class="card">
      <div class="row">
        <div>
          <div class="muted">Time remaining</div>
          <div id="timer">00:00:00</div>
        </div>
        <div style="text-align:end">
          <div class="muted">Session Earnings</div>
          <div class="big accent"><span id="sessionEarnings">0</span> coins</div>
        </div>
      </div>
      <div class="progress"><div id="progressBar" style="width:0%"></div></div>
      <div class="row" style="margin-top:12px;">
        <button id="startBtn" class="btn btn-gold">Start Mining</button>
        <button id="claimBtn" class="btn btn-ghost" disabled>Claim</button>
      </div>
    </div>
  </section>

  <!-- Wallet Tab -->
  <section class="tab" id="tab-wallet">
    <div class="card">
      <h3>Wallet Info</h3>
      <div>Balance: <span id="walletBalance">0</span> coins</div>
    </div>
  </section>

  <!-- Friends Tab -->
  <section class="tab" id="tab-friends">
    <div class="card">
      <h3>Friends</h3>
      <ul id="friendsList"></ul>
    </div>
  </section>

  <!-- Tasks Tab -->
  <section class="tab" id="tab-tasks">
    <div class="card">
      <h3>Daily Tasks</h3>
      <ul id="tasksList"></ul>
    </div>
  </section>

  <!-- Profile Tab -->
  <section class="tab" id="tab-profile">
    <div class="card">
      <h3>Profile</h3>
      <div>Username: <span id="username">Guest</span></div>
    </div>
  </section>
</main>

<nav class="tabs">
  <div class="tabs-inner">
    <button class="tab-btn active" data-tab="mining">Mining</button>
    <button class="tab-btn" data-tab="wallet">Wallet</button>
    <button class="tab-btn" data-tab="friends">Friends</button>
    <button class="tab-btn" data-tab="tasks">Tasks</button>
    <button class="tab-btn" data-tab="profile">Profile</button>
  </div>
</nav>

<script>
const API_BASE = 'https://pinet-backend-production.up.railway.app';

const balanceEl = document.getElementById('balance');
const walletBalanceEl = document.getElementById('walletBalance');
const sessionEarningsEl = document.getElementById('sessionEarnings');
const progressBarEl = document.getElementById('progressBar');
const timerEl = document.getElementById('timer');
const miningStatusEl = document.getElementById('miningStatus');
const startBtn = document.getElementById('startBtn');
const claimBtn = document.getElementById('claimBtn');
const resetBtn = document.getElementById('resetBtn');

const DURATION_MS = 24*60*60*1000; // 24h
const RATE_PER_SEC = 0.05;

let state = {
  coins:0,
  miningStart:null,
  miningEnd:null,
  sessionEarnings:0
};

// تب ها
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('section.tab').forEach(s=>s.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
  });
});

// تایمر
let timerInterval = null;
function formatTime(ms){
  const totalSec = Math.floor(ms/1000);
  const h = String(Math.floor(totalSec/3600)).padStart(2,'0');
  const m = String(Math.floor((totalSec%3600)/60)).padStart(2,'0');
  const s = String(totalSec%60).padStart(2,'0');
  return `${h}:${m}:${s}`;
}

function updateTimer(){
  if(!state.miningStart) {
    timerEl.textContent = "00:00:00";
    progressBarEl.style.width = "0%";
    sessionEarningsEl.textContent = "0";
    claimBtn.disabled = true;
    miningStatusEl.textContent = "Inactive";
    return;
  }
  const now = Date.now();
  const diff = state.miningEnd - now;
  if(diff <= 0){
    state.sessionEarnings = DURATION_MS/1000 * RATE_PER_SEC;
    sessionEarningsEl.textContent = state.sessionEarnings.toFixed(2);
    timerEl.textContent = "00:00:00";
    progressBarEl.style.width = "100%";
    claimBtn.disabled = false;
    miningStatusEl.textContent = "Finished";
    clearInterval(timerInterval);
    return;
  }
  timerEl.textContent = formatTime(diff);
  const progress = ((now - state.miningStart)/DURATION_MS)*100;
  progressBarEl.style.width = progress+"%";
  state.sessionEarnings = ((now - state.miningStart)/1000) * RATE_PER_SEC;
  sessionEarningsEl.textContent = state.sessionEarnings.toFixed(2);
  miningStatusEl.textContent = "Mining";
}

// شروع ماینینگ
startBtn.addEventListener('click',()=>{
  state.miningStart = Date.now();
  state.miningEnd = state.miningStart + DURATION_MS;
  claimBtn.disabled = true;
  if(timerInterval) clearInterval(timerInterval);
  timerInterval = setInterval(updateTimer,1000);
  updateTimer();
});

// دریافت و ثبت claim
claimBtn.addEventListener('click',async ()=>{
  state.coins += state.sessionEarnings;
  balanceEl.textContent = state.coins.toFixed(2);
  walletBalanceEl.textContent = state.coins.toFixed(2);
  state.miningStart = null;
  state.miningEnd = null;
  state.sessionEarnings = 0;
  claimBtn.disabled = true;
  progressBarEl.style.width = "0%";
  timerEl.textContent = "00:00:00";
  miningStatusEl.textContent = "Inactive";

  // ارسال به بک اند
  try{
    await fetch(`${API_BASE}/claim`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({coins:state.coins})
    });
  }catch(e){console.error(e);}
});

// reset
resetBtn.addEventListener('click',()=>{
  state = {coins:0,miningStart:null,miningEnd:null,sessionEarnings:0};
  updateTimer();
  balanceEl.textContent = "0";
  walletBalanceEl.textContent = "0";
});

updateTimer();
</script>
</body>
</html>