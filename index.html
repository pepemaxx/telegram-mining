<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pinet Clicker</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f9; }
    header { background:#2c3e50; color:white; padding:10px; text-align:center; }
    nav { display:flex; justify-content:space-around; background:#34495e; }
    nav button { flex:1; padding:10px; border:none; background:#34495e; color:white; cursor:pointer; }
    nav button.active { background:#1abc9c; }
    section { display:none; padding:20px; }
    section.active { display:block; }
    .stat { margin:10px 0; }
    .progress { height:20px; background:#ddd; border-radius:10px; overflow:hidden; }
    .progress-bar { height:100%; width:0%; background:#1abc9c; transition:width 0.5s; }
    .btn { padding:10px 15px; margin:5px; border:none; border-radius:5px; cursor:pointer; }
    .btn-primary { background:#1abc9c; color:white; }
    .btn-disabled { background:#95a5a6; color:white; cursor:not-allowed; }
    #news { margin-top:20px; padding:10px; background:#ecf0f1; border-radius:8px; }
  </style>
</head>
<body>
  <header>
    <h1>Pinet Clicker</h1>
  </header>

  <nav>
    <button class="tab-btn active" data-tab="mining">Mining</button>
    <button class="tab-btn" data-tab="wallet">Wallet</button>
    <button class="tab-btn" data-tab="friends">Friends</button>
  </nav>

  <section id="tab-mining" class="active tab">
    <h2>Mining</h2>
    <div class="stat">Balance: <span id="balance">0</span> coins</div>
    <div class="stat">Session: <span id="sessionEarnings">0</span> coins</div>
    <div class="stat">Timer: <span id="timer">00:00</span></div>
    <div class="stat">Status: <span id="miningStatus">Inactive</span></div>
    <div class="progress"><div id="progressBar" class="progress-bar"></div></div>
    <button id="startBtn" class="btn btn-primary">Start Mining</button>
    <button id="claimBtn" class="btn btn-disabled" disabled>Claim</button>
    <div id="news"><strong>News:</strong> Mining test set to 20 seconds for demo.</div>
  </section>

  <section id="tab-wallet" class="tab">
    <h2>Wallet</h2>
    <p>Here wallet stats will appear.</p>
  </section>

  <section id="tab-friends" class="tab">
    <h2>Friends</h2>
    <p>Referral system details here.</p>
  </section>

<script>
/* ================== Config ================== */
const API_BASE = 'https://pinet-backend-production.up.railway.app'; 
const STORAGE_KEY = 'pinet_clicker_state_v5';

// ⏱ تغییر داده شد: فقط ۲۰ ثانیه
const DURATION_MS = 20 * 1000;   // 20 seconds instead of 24h

const RATE_PER_SEC = 0.05;
const COINS_PER_PI = 100;
const USDT_PER_PI  = 5;
const REF_REWARD   = 30;
const MANUAL_GAIN  = 0.5;
const MANUAL_COOLDOWN = 10*1000;

/* ================== State ================== */
let balance = 0;
let sessionEarnings = 0;
let remaining = 0;
let miningActive = false;
let timerInterval;

/* ================== Elements ================== */
const balanceEl = document.getElementById("balance");
const sessionEl = document.getElementById("sessionEarnings");
const timerEl = document.getElementById("timer");
const statusEl = document.getElementById("miningStatus");
const progressEl = document.getElementById("progressBar");
const startBtn = document.getElementById("startBtn");
const claimBtn = document.getElementById("claimBtn");

/* ================== Tabs ================== */
document.querySelectorAll(".tab-btn").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    const tab = btn.dataset.tab;
    document.querySelectorAll("section.tab").forEach(sec=>sec.classList.remove("active"));
    document.getElementById("tab-"+tab).classList.add("active");
  });
});

/* ================== Mining Logic ================== */
function updateTimer(){
  const s = String(Math.floor(remaining/1000)).padStart(2,"0");
  timerEl.textContent = "00:"+s;
  const progress = 100*((DURATION_MS-remaining)/DURATION_MS);
  progressEl.style.width = progress+"%";
}

startBtn.addEventListener("click",()=>{
  if(miningActive) return;
  miningActive = true;
  remaining = DURATION_MS;
  sessionEarnings = 0;
  sessionEl.textContent = "0";
  statusEl.textContent = "Active";
  claimBtn.disabled = true;
  claimBtn.classList.add("btn-disabled");
  startBtn.disabled = true;

  timerInterval = setInterval(()=>{
    remaining -= 1000;
    sessionEarnings++;
    updateTimer();
    sessionEl.textContent = sessionEarnings;
    if(remaining<=0){
      clearInterval(timerInterval);
      claimBtn.disabled = false;
      claimBtn.classList.remove("btn-disabled");
      statusEl.textContent = "Finished";
    }
  },1000);

  updateTimer();
});

claimBtn.addEventListener("click",()=>{
  if(sessionEarnings>0){
    balance += sessionEarnings;
    balanceEl.textContent = balance;
    sessionEarnings = 0;
    sessionEl.textContent = "0";
  }
  statusEl.textContent = "Inactive";
  miningActive = false;
  startBtn.disabled = false;
  claimBtn.disabled = true;
  claimBtn.classList.add("btn-disabled");
  progressEl.style.width="0%";
  timerEl.textContent="00:00";
});

// init
balanceEl.textContent = balance;
updateTimer();
</script>
</body>
</html>
