<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PiNet – Daily Mining Clicker</title>
  <style>
    :root{
      --bg1:#5a189a; --bg2:#7b2cbf; --ink:#ffffff; --muted:#e2e8f0; --card:rgba(0,0,0,.22);
      --brand:#f1c40f; /* gold */
      --border:rgba(255,255,255,.2);
      --good:#10b981; --warn:#f59e0b; --disabled:rgba(255,255,255,.4);
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--ink);font-family:Inter, Poppins, Segoe UI, Roboto, system-ui, -apple-system, sans-serif;height:100vh;overflow:hidden;}
    /* ===== Background emblem ===== */
    .bg-stage{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;z-index:0}
    .emblem{position:relative;width:240px;height:240px;border-radius:50%;background:rgba(255,255,255,.06);backdrop-filter:blur(2px);display:flex;align-items:center;justify-content:center;box-shadow:0 8px 40px rgba(0,0,0,.25) inset, 0 0 0 1px var(--border);}
    .emblem .pi{font-size:96px;line-height:1;color:var(--brand);font-weight:900;text-shadow:0 0 24px rgba(241,196,15,.35);}
    .emblem .label{position:absolute;bottom:18px;font-weight:800;letter-spacing:.6px;color:var(--brand);text-shadow:0 0 18px rgba(241,196,15,.35)}
    .rings{position:absolute;inset:0;display:grid;place-items:center;}
    .ring{position:absolute;border:2px solid rgba(241,196,15,.35);border-radius:50%;animation:pulse 6s linear infinite;}
    .ring.r1{width:360px;height:360px;animation-delay:0s}
    .ring.r2{width:520px;height:520px;animation-delay:1s}
    .ring.r3{width:680px;height:680px;animation-delay:2s}
    @keyframes pulse{0%{opacity:.45}50%{opacity:.2}100%{opacity:.45}}
    #app{position:relative;z-index:1;height:100%;display:flex;flex-direction:column}
    header{position:sticky;top:0;z-index:5;background:rgba(0,0,0,.15);backdrop-filter:blur(8px);border-bottom:1px solid var(--border);padding:12px 16px;display:flex;align-items:center;justify-content:space-between}
    .title{font-weight:800;font-size:18px}
    .sub{font-size:12px;color:var(--muted)}
    .btn{border:none;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn-gold{background:var(--brand);color:#4c1d95}
    .btn-ghost{background:rgba(255,255,255,.12);color:#fff;border:1px solid var(--border)}
    main{flex:1;overflow-y:auto;padding:16px 16px 100px;max-width:820px;margin:0 auto}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px 16px;box-shadow:0 6px 24px rgba(0,0,0,.15);margin-top:12px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .muted{color:var(--muted);font-size:12px}
    .big{font-size:28px;font-weight:800}
    .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06)}
    .pill.good{background:rgba(16,185,129,.15);color:#d1fae5;border-color:rgba(16,185,129,.4)}
    .pill.warn{background:rgba(245,158,11,.14);color:#fff;border-color:rgba(245,158,11,.45)}
    .progress{height:10px;border-radius:999px;background:rgba(255,255,255,.18);overflow:hidden}
    .progress>div{height:100%;background:var(--brand);transition:width .25s}
    .mine-wrap{display:grid;gap:12px}
    .mine-cta{height:56px;font-size:16px}
    #timer{font-weight:800;color:#fee440;font-size:22px}
    .accent{color:var(--brand)}
    nav.tabs{position:fixed;left:0;right:0;bottom:0;border-top:1px solid var(--border);background:rgba(0,0,0,.18);backdrop-filter:blur(10px)}
    .tabs-inner{max-width:820px;margin:0 auto;height:72px;display:grid;grid-template-columns:repeat(5,1fr)}
    .tab-btn{appearance:none;background:none;border:none;color:#e2e8f0;font-size:14px;display:flex;align-items:center;justify-content:center}
    .tab-btn .pill{background:transparent}
    .tab-btn.active{color:var(--brand)}
    .tab-btn.active .pill{background:rgba(241,196,15,.12);border-color:rgba(241,196,15,.35)}
    .list{list-style:none;margin:0;padding:0}
    .list li{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-top:1px solid var(--border)}
    input, select{background:rgba(255,255,255,.08);border:1px solid var(--border);color:#fff;border-radius:10px;padding:10px 12px;outline:none}
    input::placeholder{color:#cbd5e1}
    .input-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    section.tab{display:none}
    section.tab.active{display:block}
  </style>
</head>
<body>
<!-- Background center emblem with concentric circular lines -->
<div class="bg-stage" aria-hidden="true">
  <div class="rings">
    <div class="ring r1"></div>
    <div class="ring r2"></div>
    <div class="ring r3"></div>
  </div>
  <div class="emblem">
    <div class="pi">π</div>
    <div class="label">PiNet</div>
  </div>
</div>

<div id="app">
  <header>
    <div>
      <div class="title">PiNet – Daily Mining</div>
      <div class="sub">24h mining • Persistent (Backend)</div>
    </div>
    <button id="resetBtn" class="btn btn-ghost">Reset</button>
  </header>

  <main>
    <!-- Mining Tab -->
    <section class="tab active" id="tab-mining">
      <div class="card row">
        <div>
          <div class="muted">Wallet Balance</div>
          <div class="big"><span id="balance">0</span> <span class="muted" style="font-size:14px">coins</span></div>
        </div>
        <div style="text-align:end">
          <div class="muted">Mining Status</div>
          <div id="miningStatus" class="pill">Inactive</div>
        </div>
      </div>

      <div class="card mine-wrap">
        <div class="row" style="align-items:flex-end">
          <div>
            <div class="muted">Time remaining</div>
            <div id="timer">00:00:00</div>
          </div>
          <div style="text-align:end">
            <div class="muted">Earnings this session</div>
            <div class="big accent"><span id="sessionEarnings">0</span> coins</div>
          </div>
        </div>
        <div class="progress"><div id="progressBar" style="width:0%"></div></div>
        <div class="row">
          <button id="startBtn" class="btn btn-gold mine-cta">Start 24h mining</button>
          <button id="claimBtn" class="btn btn-ghost mine-cta" disabled>Finish & Claim</button>
        </div>
        <div class="muted">Current rate: <span id="rateText">0</span> coin/sec • Close app anytime; progress continues.</div>
      </div>
    </section>

    <!-- Wallet Tab -->
    <section class="tab" id="tab-wallet">
      <div class="card row">
        <div>
          <div class="muted">Coins</div>
          <div class="big" id="coinsBalance">0</div>
        </div>
        <div>
          <div class="muted">Pi</div>
          <div class="big" id="piBalance">0</div>
        </div>
        <div>
          <div class="muted">USDT</div>
          <div class="big" id="usdtBalance">0</div>
        </div>
      </div>
      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Conversions</div>
        <div class="muted" style="margin-bottom:6px">Rates (demo): 100 coins → 1 Pi • 1 Pi → 5 USDT</div>
        <div class="input-row" style="margin-bottom:8px">
          <input id="coinsToPiAmt" type="number" min="0" step="1" placeholder="Coins amount">
          <button id="coinsToPiBtn" class="btn btn-gold">Convert Coins → Pi</button>
        </div>
        <div class="input-row" style="margin-bottom:8px">
          <input id="piToUsdtAmt" type="number" min="0" step="0.01" placeholder="Pi amount">
          <button id="piToUsdtBtn" class="btn btn-gold">Convert Pi → USDT</button>
        </div>
        <div class="input-row">
          <button class="btn btn-ghost" id="withdrawPiBtn" disabled title="Coming soon">Withdraw Pi</button>
          <button class="btn btn-ghost" id="withdrawUsdtBtn" disabled title="Coming soon">Withdraw USDT</button>
        </div>
        <div class="muted" style="margin-top:8px">Withdrawals are <b>coming soon</b>.</div>
      </div>

      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Transactions</div>
        <ul id="txList" class="list"></ul>
        <div id="noTx" class="muted">No transactions yet.</div>
      </div>
    </section>

    <!-- Friends Tab -->
    <section class="tab" id="tab-friends">
      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Your invite link</div>
        <div id="refLink" class="muted" style="word-break:break-all;background:rgba(255,255,255,.09);border:1px dashed var(--border);padding:10px;border-radius:12px"></div>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
          <button id="copyRef" class="btn btn-gold">Copy link</button>
          <button id="mockInvite" class="btn btn-ghost">Simulate invite +1</button>
          <button id="mockActivate" class="btn btn-ghost">Simulate active +1</button>
        </div>
      </div>
      <div class="card row">
        <div>
          <div class="muted">Invited</div>
          <div class="big" id="friendsInvited">0</div>
        </div>
        <div>
          <div class="muted">Active</div>
          <div class="big" id="friendsActive">0</div>
        </div>
        <div class="pill good">+30 coins per active friend</div>
      </div>

      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Top 10 Leaderboard</div>
        <ol id="leaderList" style="text-align:left"></ol>
        <div style="margin-top:8px" class="muted">Your Rank: <b id="myRank">#112131</b></div>
      </div>
    </section>

    <!-- Tasks Tab -->
    <section class="tab" id="tab-tasks">
      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Social Tasks (demo)</div>
        <div id="tasksWrap"></div>
        <div class="muted" style="margin-top:8px">* Links are examples. Real verification needs a backend.</div>
      </div>
    </section>

    <!-- Profile Tab -->
    <section class="tab" id="tab-profile">
      <div class="card">
        <div class="kicker" style="font-weight:800;margin-bottom:8px">Profile</div>
        <div class="input-row" style="margin-bottom:8px">
          <input id="firstName" placeholder="First name" />
          <input id="lastName" placeholder="Last name" />
          <input id="userId" placeholder="User number" />
          <button id="saveProfile" class="btn btn-gold">Save</button>
        </div>
        <div class="muted">Saved on backend.</div>
      </div>
    </section>
  </main>

  <nav class="tabs">
    <div class="tabs-inner">
      <button class="tab-btn active" data-tab="mining"><span class="pill">Mining</span></button>
      <button class="tab-btn" data-tab="wallet"><span class="pill">Wallet</span></button>
      <button class="tab-btn" data-tab="friends"><span class="pill">Friends</span></button>
      <button class="tab-btn" data-tab="tasks"><span class="pill">Tasks</span></button>
      <button class="tab-btn" data-tab="profile"><span class="pill">Profile</span></button>
    </div>
  </nav>
</div>

<script>
  // ===== Backend API =====
  const API_BASE = 'https://pinet-backend-production.up.railway.app';
  const DURATION_MS = 24*60*60*1000;
  const RATE_PER_SEC = 0.05;
  const REF_REWARD = 30;
  const COINS_PER_PI = 100;
  const USDT_PER_PI = 5;

  // ===== State =====
  let state = null;

  // ===== Elements =====
  const $ = id=>document.getElementById(id);
  const balanceEl = $('balance'), miningStatusEl = $('miningStatus'), timerEl = $('timer'),
        sessionEarningsEl = $('sessionEarnings'), progressBarEl = $('progressBar'),
        startBtn = $('startBtn'), claimBtn = $('claimBtn'), rateText = $('rateText');

  const coinsBalanceEl = $('coinsBalance'), piBalanceEl = $('piBalance'), usdtBalanceEl = $('usdtBalance'),
        txListEl = $('txList'), noTxEl = $('noTx'), coinsToPiAmt = $('coinsToPiAmt'),
        coinsToPiBtn = $('coinsToPiBtn'), piToUsdtAmt = $('piToUsdtAmt'), piToUsdtBtn = $('piToUsdtBtn');

  const refLinkEl = $('refLink'), copyRefBtn = $('copyRef'),
        mockInviteBtn = $('mockInvite'), mockActivateBtn = $('mockActivate'),
        friendsInvitedEl = $('friendsInvited'), friendsActiveEl = $('friendsActive'),
        leaderListEl = $('leaderList'), myRankEl = $('myRank');

  const tasksWrap = $('tasksWrap');

  const firstNameInput = $('firstName'), lastNameInput = $('lastName'), userIdInput = $('userId'),
        saveProfileBtn = $('saveProfile');

  let tickId = null;
  rateText.textContent = RATE_PER_SEC.toString();

  // ===== Init =====
  setupTabs();
  initState().then(()=>{setupMining(); setupWallet(); setupFriends(); setupTasks(); setupProfile(); setupReset();});

  // ===== Tabs =====
  function setupTabs(){
    document.querySelectorAll('.tab-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('section.tab').forEach(s=>s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('tab-'+btn.dataset.tab).classList.add('active');
      });
    });
  }

  // ===== State Load/Save =====
  async function initState(){
    try{
      const res = await fetch(`${API_BASE}/state`);
      if(res.ok) state = await res.json();
      else throw new Error('Fetch failed');
    }catch(e){
      // fallback demo state
      state = {coins:0, pi:0, usdt:0, tx:[], mining